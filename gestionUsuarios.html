<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/> 
    <title>Gestión de Usuarios</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin:20px 0;
        }
        th, td {
            border:1px solid #ccc;
            padding:10px;
            text-align:left;
        }
        th {
            background:#f0f0f0;
        }
        button {
            padding:5px 10px;
        }
    </style>
</head>
<body>
    <h1>Gestión de Usuarios</h1>
    <table>
        <thead>
            <tr>
                <th>Email</th>
                <th>Nombre</th>
                <th>Apellidos</th>
                <th>Centro</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="usersTableBody"></tbody>
    </table>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const usuarioLogeado = JSON.parse(sessionStorage.getItem("usuarioLogeado"));
        if (!usuarioLogeado || usuarioLogeado.rol !== "admin") {
            window.location.href = "login.html";
            return;
        }

        const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
        const tbody = document.getElementById("usersTableBody");

        // Renderizar la tabla
        usuarios.forEach((u, index) => {
            const tr = document.createElement("tr");
            
            // Datos de las celdas
            tr.innerHTML = `
                <td>${u.email}</td>
                <td>${u.nombre}</td>
                <td>${u.apellidos}</td>
                <td>${u.centro}</td>
                <td>${u.rol}</td>
                <td>
                    <select data-index="${index}" class="estadoSelect">
                        <option value="activo" ${u.estado === "activo" ? "selected":""}>activo</option>
                        <option value="congelado" ${u.estado === "congelado" ? "selected":""}>congelado</option>
                    </select>
                </td>
                <td><button class="guardarBtn" data-index="${index}">Guardar</button></td>
            `;
            tbody.appendChild(tr);
        });

        // Evento para guardar cambios
        document.querySelectorAll(".guardarBtn").forEach(btn => {
            btn.addEventListener("click", (e) => {
                const idx = e.target.getAttribute("data-index");
                const select = document.querySelector(`.estadoSelect[data-index="${idx}"]`);
                const nuevoEstado = select.value;
                
                usuarios[idx].estado = nuevoEstado;
                localStorage.setItem("usuarios", JSON.stringify(usuarios));
                alert("Estado actualizado con éxito.");
            });
        });
    });
    </script>
</body>
</html>
